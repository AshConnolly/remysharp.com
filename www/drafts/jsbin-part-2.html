<!DOCTYPE html PUBLIC "Uncompressed source: https://github.com/remy/remysharp.com"><html id="remysharp-com"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The toxic side of free. Or how I the my love for my side project</title><meta name="description" content="The toxic side of free. Or how I the my love for my side project"/><meta name="HandheldFriendly" content="True"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="stylesheet" type="text/css" href="/css/screen.css?2.22"/><link rel="stylesheet" type="text/css" href="/css/zenburn.css?2.22"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds.feedburner.com/remysharp"/><link rel="alternate" type="text/xml" title="RSS .92" href="http://feeds.feedburner.com/remysharp"/><link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://feeds.feedburner.com/remysharp"/><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1656750-1', 'auto');
ga('send', 'pageview');</script></head><body id="drafts-jsbin-part-2-page"><nav class="main-nav clearfix subpanel"><form action="/search" class="search"><input type="text" name="q" placeholder="Search for..."/><input type="submit" value="Search"/></form><ul class="post-nav"><li class="home"><a href="/">Home</a></li><li class="search"><a id="search" href="#search">Search</a></li><li class="next"><a href="/2015/06/02/bind" title="Tiny two way data binding">Latest post</a></li></ul></nav><main role="main" class="content"><div class="warning">Draft posts are a work in progress.&nbsp;Last edited 2-Jun 2015</div><article class="post"><h1 class="title"><a href="/drafts/jsbin-part-2">The toxic side of free. Or how I the my love for my side project</a><small class="edit"><a href="https://github.com/remy/remysharp.com/blob/master/public/drafts/jsbin-part-2.md">(edit)</a></small></h1><div class="post-content">
<p>This is a story about JS Bin. I&#39;ve told one story of jsbin before, and this is the b-side, the dark side. But remember with everything I share with you, jsbin is the longest running live pastebin, and it&#39;s not going anywhere. It will continue to run and serve its users. Even the scumbags.</p>
<h2>Backstory</h2>
<p>I was working mostly out of my bedroom (since our flat was small) but still working with for my first company in London amongst designers and developers. jQuery was still new and I&#39;d often be asked in written English why XYZ didn&#39;t work. I knew I needed something that contained code that would pare down the issue so I could investigate.</p>
<p><img src="/images/office-2009.jpg" alt="2009 office"></p>
<p>JS Bin was launched on <a href="https://remysharp.com/2008/10/06/js-bin-for-collaborative-javascript-debugging">September 2008</a> as my solution to needing to see a pastebin with an interactive component.</p>
<p>It was posted up on Ajaxian and had a good reception. I had started seeding it&#39;s use by answering Stack Overflow questions and linking to live demos in JS Bin. To this day this was a great success - particularly as Stack Overflow went on to create their own live pastebin support (though it looks like a poorly imeplementation of jsfiddle).</p>
<p>The concept from day one was simple: you could, anonymously, create a web page for anyone to view and edit (creating a new &quot;revision&quot;).</p>
<p>Initially around a 4 hour hack with 2 PHP files (<a href="https://github.com/jsbin/jsbin/blob/e895c32089ac1bd310b5d91aecabda219f2eccea/sandbox.php">sandbox.php</a> and <a href="https://github.com/jsbin/jsbin/blob/e895c32089ac1bd310b5d91aecabda219f2eccea/index.php">index.php</a>) and one very simple MySQL database. Over time it would become more complex, with many many more features - mostly tucked away a very sleek design (by <a href="https://twitter.com/yandle">Danny Hope</a>).</p>
<p>JS Bin grew and grew over the years. I&#39;ve gone through a couple of major rewrites and now settled on Node for it&#39;s backend (though still MySQL) on an AWS based architecture.</p>
<p>Somehow, JS Bin was the first to suffer real abuse, but I know jsfiddle has come under fire pretty heavily in recent years. I&#39;m unsure if CodePen has really had much abuse yet (possibly because it&#39;s the newbie on the block).</p>
<hr>
<p>This is a story, and not a happy one, of some of the trials and tribulations that left my little open source project with a toxic taste in it&#39;s mouth.</p>
<p>Please also bear in mind throughout these tales, that I am the soul sysadmin, and my knowledge, though workable, is limited - as are the pennies in my pocket, so <em>no</em> there&#39;s no load balancers and heavy duty sentinel machines that protect my system from madness. It&#39;s <em>just</em> me.</p>
<hr>
<h2>Part 1: The start of the DDoS</h2>
<p>I don&#39;t recall if I had seen any abuse on JS Bin before this point in time, but in late April 2012, I received an email requesting my attention:</p>
<p><img src="/images/jsbin-first-ddos.png" alt="First DDoS"></p>
<p>I was travelling at the time and running workshops, and deletion was a manual job, but as soon as I could I investigated and removed the bin (today it resolves to a 404).</p>
<p>The bin was a <em>script kiddie&#39;s</em> paradise: enter the URL of your target, and it would repeatedly create image requests to the target. In fact, this kind of page would be the source of quite a few incidents over the years.</p>
<p>The thing that bugged me, and still bugs me to this day, was: <em>why do they host this on JS Bin? They have to share a link, why not share an HTML file?</em></p>
<p>This would mean that JS Bin wouldn&#39;t be caught in the middle. ¯\<em>(ツ)</em>/¯</p>
<h3>The alternative DDoS: self-attacks by the moronic</h3>
<p>Thankfully the self-attacks happened <em>after</em> JS Bin had moved to Node, otherwise I&#39;m not sure it would survive.</p>
<p>In fact, JS Bin doesn&#39;t always remain calm during these attacks. <em>Self-attacks?</em> Yep. It&#39;s when the script kiddie page asks for a URL, but the page doesn&#39;t do any validation on the URL, and, since it takes very little brain cells to want to orchestrate the attack, some moron leaves off the preceding &quot;http://&quot; part in their attack.</p>
<p>The result? They start to attach URLs like <a href="http://jsbin.com/abcef/some-site-the-user-hates.com">http://jsbin.com/abcef/some-site-the-user-hates.com</a> - which does actually go through JS Bin&#39;s sub-system.</p>
<p>Sometimes, not always, but sometimes it results in this, and that&#39;s when it gets really hairy...</p>
<p><img src="/images/jsbin-502.jpg" alt="JS Bin 502"></p>
<h3>&quot;Always strike when they&#39;re sleeping...&quot;</h3>
<p><img src="/images/jsbin-twitter-reports.jpg" style="width: 50%; display: block; float: right" alt="Twitter reports"></p>
<p>Okay, so this might not be some secret mantra that arse hats always attack whilst the sys-admin sleeps, it might actually be that since I&#39;m based in the UK, most attacks happen during central America midday time...so yeah, I&#39;m sleeping and I wake up (around 6am) to twitter reports of JS Bin being unreachable.</p>
<p>It&#39;s pretty disheartening when most of the @replies to the product you&#39;ve poured your soul into are: the shit has hit the fan!</p>
<div style="clear:both"></div>

<h3>When there&#39;s an endless supply of shit</h3>
<p>I actually have a <a href="http://jsbin.com/help/runbook/slow-response">runbook</a> for when this happens. When JS Bin comes under heavy fire, whatever that attack looks like. Most of the time the solution would be to restart JS Bin. However, it would also tend to come from a few specific IP addresses.</p>
<p>I do also get AWS CloudWatch alerts when the CPU on JS Bin machines run high (for a number of seconds). The constant hitting traffic against the node process (yes...a single process) results in the process being constantly &quot;busy&quot;, i.e. high CPU rate, so there <em>are</em> alarms I get.</p>
<p>So the runbook would scan the latest 200 lines (or so) of the access log and spit out the unique IPs and the count of their hits. From there, would go about <code>iptable</code>&#39;ing the addresses (i.e. blocking the IP address).</p>
<p>One night got <em>so bad</em> that I had to write a script in a cronjob that would repeatedly scan the logs for any IP hitting JS Bin more than some arbitrary figure, and it would ban them.</p>
<p>It did resolve the issue. It also randomly blocked many, many more regular users who were keen to let me know via Twitter and the GitHub issues (which is a good thing, I&#39;m not complaining - it just sucks for them that they got caught in the cross fire).</p>
<h3>fail2ban</h3>
<p>Eventually I cottoned on to using <a href="">fail2ban</a> to protect my machine from repeated hits from a specific IP address. Since installing around late 2014, it&#39;s massively reduced the attacks of this nature.</p>
<p>The unfortunate side effect is that it also blocks out class room use of JS Bin, since JS Bin sends XHR writes <em>all the time</em>, fail2ban sees this all coming from a single IP, and goes ahead and denies the eager young class from learning.</p>
<p>In this situation, classes have got in touch via any channel possible, and I&#39;ve white listed their IP address manually. I know it&#39;s caught some people out, but, sadly, this is the cost I&#39;ve had to pay.</p>
<hr>
<h2>Part 2: Spam</h2>
<p>Who doesn&#39;t love a filthy does of spam with their product? Let&#39;s picture exactly what JS Bin is: a place that people can <em>anonymously</em> create public web pages.</p>
<p>So...yeah...I guess I should have known I was asking for trouble.</p>
<p>JS Bin, as of April 2015, has well over 15,000,000 bins. It crossed 10 million bins late last year, so that number has been accelerating. It should. That&#39;s what growth is about. But I had to face it, there&#39;s no way there&#39;s 5 million new bins with everyone learning the magic of the web stack. There&#39;s going to be some spam in there.</p>
<h3>Affiliate spam</h3>
<p>No, not spam that I, or JS Bin are affiliated with! At some point in 2014, I searched Google with &quot;site:jsbin.com&quot; just to see what awesome content existed. Sadly, Google&#39;s only reply, and pages of reply, was this &quot;affiliate spam&quot;.</p>
<p>Bear with me: it&#39;s a page that contains a tonne of links that usually entices the reader to click through for some kind of random product. Maybe a DVD or a CD containing the secrets to earning your first million or some such nonsense.</p>
<p>In some cases, since I have admin access to JS Bin, I would just delete the bin. But it was (and is) like playing whack-a-mole. You delete one, and immediately find another - partly also because with JS Bin, you&#39;re deleting a revision, and not the whole collection of bins (I&#39;ve yet to develop that).</p>
<p>So in this case, I would head to the database and run dangerous manual queries to delete all the bins with the offending URL. Thankfully, in the 15 million rows, I had the good sense to add a index early on to the URL field, so it&#39;s quick and doesn&#39;t lock up the table.</p>
<h3>SEO spam</h3>
<p>I don&#39;t really understand what this is, but it&#39;s definitely a thing. Similar to the affiliate junk, SEO spam would just contain an insane amount of links to web sites. I still don&#39;t understand it, but it&#39;s definitely nefarious.</p>
<h3>Phishing</h3>
<p>Yay, phishing. Phishing is actually the very first type of abuse I ever came across on JS Bin. I don&#39;t remember who reported it to me, but at some point, someone was trying to phish the Habbo.com homepage.</p>
<p>It&#39;s why, even today, the <a href="https://github.com/jsbin/jsbin/blob/config.default.json"><em>public</em> config</a> for JS Bin contains a default blacklist for <code>habbo.com</code> and <code>processform.cgi</code>. The blacklist prevents the bin from being saved. Everything works, but it just silently fails to save.</p>
<p>In production the blacklisting is much much larger these days, and includes frankly stupid stuff like <code>kardishain</code>, <code>Clickbank</code> and snippets of nasty code like <code>...|63|0A|27|73|70|2E|2F|...</code> which aims to prevent code that&#39;s used in some kinds of attacks.</p>
<p>But yeah: whack-a-mole.</p>
<h3>Link hiding</h3>
<p>The last type of spam that appeared in JS Bin is using JS Bin as a link sharing site to the dark and shitty side of the web. Arsehats (the nasty users, as I like to call them) would use JS Bin to redirect using <code>top.location=&quot;http://arsehat.com&quot;</code>. Then, using the full output URL, it would be shared on networks like Twitter and Facebook.</p>
<p>Since &quot;arsehat.com&quot; was already blocked on Facebook and Twitter, but JS Bin wasn&#39;t, it&#39;s an efficient way to share links to bad places, and hide under JS Bin.</p>
<p>It&#39;s kinda depressing that when I search Twitter for &quot;jsbin.com&quot;, it would mostly yield weirdos sharing things like webcams to their toilet fetish funsies.</p>
<h3>If you can&#39;t play nice...</h3>
<p>In August 2014, I made the hard decision that I would have to reduce JS Bin&#39;s functionality if it was going to continue to positively contribute to the web, instead of flooding it sludge filled spam.</p>
<p>I limited the full output <em>for anonymous bins</em> to last 90 minutes, then it would automatically revert to the edit view. Since the edit view is compiled using JavaScript, it had no use to SEO indexing. The live output <code>iframe</code> is also protected with a <code>sandbox</code> attribute that prevents location redirects, so the link hiding issue also (mostly) went away.</p>
<p>Finally, all output views (i.e. the full output without the &quot;JS Bin editor&quot; bit) include the <code>X-Robots-Tag: nofollow</code> header - which is the new way of doing <code>robots.txt</code>. This seems to have helped stamp out the &quot;SEO&quot; use of JS Bin.</p>
<p>But it didn&#39;t end there...</p>
<hr>
<h2>Part 3: Registered users wreaking havoc</h2>
<p>Originally JS Bin was 100% anonymous. I liked that. But after about a year (or so...I forget), there was clearly an important feature missing: people couldn&#39;t recall their old bins.</p>
<p>Duh. Obviously. It&#39;s <em>anonymous</em>. But that didn&#39;t really fly for an answer. Before the full version 3 rewrite (from PHP to Node), I implemented a simple system that you could &quot;register&quot; your name and &quot;key&quot; as your token. This meant that advanced users would know how to recall their bins (so long as this special cookie was in place).</p>
<p>When I realised I had implemented user sign-in in quite possibly the crapest way, version 3, new, clean, slick JS Bin, came with proper sign-in, register and password reminder.</p>
<p>With one fatal flaw: there were zero checks on your account. No email authentication, no captcha (I hate crapchas), no nothing. And registered users didn&#39;t have <em>any</em> limitations on their bins - the public output would remain public.</p>
<p>This, unknowingly to me, lead to an increase in registrations. Yay! No. Not yay. These were not the kinds of folk you wanted in your system. What&#39;s worse, is these users would create multiple accounts to create multiple bins, all of which were not limited. They&#39;d still be limited by the blacklisting, but blacklisting is simple and probably doesn&#39;t even catch 20% of the junk.</p>
<h3>The full on Death Star-explode-day</h3>
<p>Earlier I mentioned that the bins went from 10 million to 15 million in around 6 months (or so). Our registration rate was also climbing insanely quickly.</p>
<p>The net effect of this: storing more content.</p>
<p>Storage is cheap, right? Sure is. JS Bin stores it&#39;s database on a 100GB drive. It&#39;s <em>just text</em> for heavens sake.</p>
<p>On 26th March 2015 JS Bin&#39;s database ran out of disk space. All of it. Gone. So much so, that I <em>couldn&#39;t delete data</em>. (I think) because MySQL needs to create a tmp file to run queries, that since there was literally no disk space, it couldn&#39;t create the tmp file to delete the junk bins that were seemingly coming in faster and faster.</p>
<p>The weird thing was that JS Bin still worked. It could recall bins and you could use JS Bin, you <em>just couldn&#39;t save</em> (though, that&#39;s kind of a problem...).</p>
<p><img src="/images/jsbin-kids.jpg" alt="The Sharps"></p>
<p>This all happened on a morning that I was looking after my two kids. I had absolutely no choice but to just suck it up, and try to focus on the kids and ignore the problem until my wife returned home. I did manage to put out a <a href="https://twitter.com/rem/status/581004721785167872">cry</a> for <a href="https://github.com/jsbin/jsbin/issues/2320">help</a> which had lots of lovely support, but support doesn&#39;t fix fucked disks.</p>
<p>Though, eventually, a few hours later, I managed to swap in a 400GB disk to the AWS database. This solved the issue right away, but the source of the problem was still wide open.</p>
<h3>If you (still) can&#39;t play nice...</h3>
<p>Wide open registrations was always a stupid idea. An entirely anonymous web site, given JS Bin&#39;s purpose, is also a stupid idea.</p>
<p>In the end the <em>only</em> way to register with JS Bin <em>now</em> is via GitHub. I don&#39;t like this, but it does lean on GitHub&#39;s verification process. It doesn&#39;t kill the issue 100%, but it reduced our sign-up rate significantly and we only have the odd one arsehat come through (which I also then report back to GitHub).</p>
<hr>
<h2>Part 4: On losing money...</h2>
<p>In July 2014, JS Bin finally landed <a href="https://jsbin.com/upgrade">Pro accounts</a>. The aim of this would be for JS Bin to eventually be self-sustaining. It&#39;s been running on my pocket for the previous 6 year (for server and related costs), and development and design (2014 excluded) had been lovely &quot;donated&quot; by myself and Danny (who is responsible for the design).</p>
<p>In 2014, I decided to give JS Bin a full shot, and employed two (amazing) developers, <a href="https://twitter.com/electric_g">Giulia Alfonsi</a> and <a href="https://twitter.com/allouis_">Fabien O&#39;Carroll</a> to work with me full time on JS Bin.</p>
<p>At the end of May 2015 (10 months after launching pro) the income JS Bin has provided has only <em>just</em> covered operating costs for the previous year. That&#39;s huge, because before it wasn&#39;t - so that&#39;s something, <em>but</em> it doesn&#39;t even touch the edges of what I had hoped it would return (and I wasn&#39;t even being optimistic, as any British person would expect).</p>
<h3>VAT MOSS</h3>
<ul>
<li><a href="https://twitter.com/search?q=from%3Arem%20%23vatmoss&amp;src=typd">https://twitter.com/search?q=from%3Arem%20%23vatmoss&amp;src=typd</a></li>
<li><a href="https://twitter.com/rem/status/589057179258327040">https://twitter.com/rem/status/589057179258327040</a></li>
</ul>
<h2>Fraud credit cards</h2>
<p>Since we only charge £6 a month, its a nice low test for stolen credit cards to be tested with. Then there&#39;s the refund and the £15 processing fee.</p>
<p>So I&#39;ve taken to checking each and every individual sign up and their bins to see if they look spammy. I caught my first fraud card and reported on 13-April 2014. Not a huge success but very satisfying to know I&#39;ve avoided the charge.</p>
<h2>Part 6: The Police</h2>
<ul>
<li>Phone call from London met</li>
<li>Email from Spanish police + porn</li>
</ul>
<h3>Terrorist use</h3>
<ul>
<li>Anonymous / <a href="https://twitter.com/zalun/status/602586249203945472">https://twitter.com/zalun/status/602586249203945472</a></li>
</ul>
<p class="update">Drafts may be incomplete or entirely abandonded, so please forgive me. If you find an issue with a draft, or would like to see me write about something specifically, please try <a href="http://github.com/remy/remysharp.com/issues/new">raising an issue</a>.</p></div></article></main><footer class="site-footer clearfix flex subpanel"><div class="flex-item archives"><h2>Archives</h2><ul><li><a href="/archive">All years</a></li><li><a href="/2015">2015</a></li><li><a href="/2014">2014</a></li><li><a href="/2013">2013</a></li><li><a href="/2012">2012</a></li><li><a href="/2011">2011</a></li><li><a href="/2010">2010</a></li><li><a href="/2009">2009</a></li><li><a href="/2008">2008</a></li><li><a href="/2007">2007</a></li><li><a href="/2006">2006</a></li></ul></div><div class="flex-item links"><h2>Links</h2><ul><li><a href="/about">About Remy</a></li><li><a target="_blank" href="/feed.xml">RSS feed</a></li><li><a href="/search">Search</a></li><li><a target="_blank" href="https://github.com/remy">On GitHub</a></li><li><a target="_blank" href="https://twitter.com/rem">On Twitter</a></li><li><a target="_blank" href="http://lanyrd.com/profile/rem/past/speaking/">Presentations</a></li></ul></div><div class="flex-item license"><h2>License</h2><p class="vcard">All content by <a class="url fn" href="http://remysharp.com">Remy Sharp</a> and under <a href="http://creativecommons.org/licenses/by-nc-sa/2.0/uk/">creative commons</a> and code under <a href="http://rem.mit-license.org">MIT license</a>.</p><p>All code and content for this blog is available as <a href="https://github.com/remy/remysharp.com">open source on GitHub</a>.</p>
</div></footer><script src="//code.jquery.com/jquery-1.11.1.min.js"></script><script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script><script src="/js/jquery.fitvids.js"></script><script src="/js/highlight.min.js"></script><script src="/js/permalink.js?2.22"></script><script src="/js/index.js?2.22"></script><!--  
  
 Carved up by hand using Harp and a shit load of hacking.
  
  Also, this:
  
  
  
                       \_            /;              _.._
                       `\~--.._     //'            ,(+=\\\\
                        `//////\  \\/;'             /~ (\\\\
                          ~/////\~\`)'             /;   ))))
                              `~'  |              ((`~/((((\
                              ;'_\'\             /'))   )))))
                             /~/ '" "'     _.  /'/\_ /^\`((( \
                            `\/'       _.-~/--/ (  =(   | ,  |
                                    _/~\_)_}___/^\/~`\.__\|==|
                                   /uUUU)        )        |  |
                                  (   / |      _-=o|\__ /'/~ \
                                  ' /'  |     /(((((\`\(  |~\/
                                  /'    |   /' )))))"`\`\|/_/---.._,$$,
                            .,ssS$$$Sss|._/_..-((('    )\)>>>      ~\$
                         ,sS$$$$$$$$$$$|$$$$$$$  |/    //'~`o        `\
                       ,$$$$$$$$$$$$$$|$$S$$$$'  (    /                \
                     ,$$$$$$$$$$$$S$$|$$$$$$$'   |   /              ,s$$$
                   s$$$$$S$$$$$$$$$S|$$$$$$$$    |  /              $$$$$$
                 _~,$S""''     ``"S|$$S$$$$$"    (_,`\,          ,$$$$$$$;
               /~ ,"'             / 'S$$$$$"      \_./|        s$$$$$$$$$$
            (~'      _,  \==~~)  /     """         \  |       $$$$$$$$$$$$
             (0\   /0/     \-' /'                   \ |  |  ,$$$$$$$$$$$$$,
             `/'  '         _-~                     |= \_-\ $$$$$$$$$$$$$$s
             (~~~)      _.-~_-   \             \  ,s|= |   `"$$$$$$$$$$$$$$$
            ( `-'  )/>-~  _/-__   |            |,$$$|_/,      `"$$$$$$$$$$$$
            /V^^^^V~/' _/~/~~  ~~-|            |$$$$$$$$         "$$$$$$$$$$,
           /  (^^^^),/' /'        )           /S$$$$$$$;         ,$$$$$$$$$$$,
         ,$$_  `~~~'.,/'         /     _-ss, /(/-(/-(/'        ,s$$$$$$$$$$$$$
       ,s$$$$$ssSS$$$'         ,$'.s$$$$$$$$'                  (/-(/-(/-(/-(/'
      S$$$$$$$$$$$$$$        ,$$$$$$$$$$$$$'
     (/-(/-(/-(/-(/'      _s$$$$$$$$$$$$$$
                         (/-(/-(/-(/-(/-'
  
  
  
     – Remy
  
  --><!-- Env: production - static files--></body></html>